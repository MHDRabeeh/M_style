
<%-include('../partials/nevTwo') %> 






<section class="breadcrumb-section set-bg mb-3" data-setbg="/img/breadcrumb.jpg">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-center">
        <div class="breadcrumb__text">
          <h2>My Profile</h2>
          <div class="breadcrumb__option">
            <a href="/">Home</a>
            <span>Profile</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Breadcrumb Section End -->
<style>
  .me-2 {
    margin-right: .5rem !important;
  }

  .user-profile {
    background-color: #edebeb;
  }

  .list-group-item:hover {
    background-color: #edebeb;
  }
</style>

<div class="container">
  <div class="main-body mb-3">
    <div class="row">
      <div class="col-lg-4">
        <div class="card">
          <div class="card-body mb-2">
            <div class="d-flex flex-column align-items-center text-center">
              <div class="mt-3">
                <h4>Hi <%= myUser.name %> </h4>
                <p class=" mb-1"><%= myUser.email %> </p>
              </div>
            </div>
            <hr class="my-4">
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <a href="#" id="userProfile" class="text-dark h6"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                  <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                </svg> My Account</a>
              </li>
              <li class="list-group-item">
                <a href="/myOrders" class="text-dark h6"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-checklist" viewBox="0 0 16 16">
                  <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                  <path d="M7 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 1 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0zM7 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 0 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0z"/>
                </svg> My Orders</a>
              </li>
              <li class="list-group-item">
                <a href="#" id="userPassword" class="text-dark h6"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-key-fill" viewBox="0 0 16 16">
                  <path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>


                    <!-- Change Password -->

                </svg> Change Password</a>
              </li>
              <li class="list-group-item">
                <a href="#" class="text-dark h6" onclick="document.getElementById('logoutForm').submit();"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-8">
        <div class="card">
          <form action="/add-profile" method="post">
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-sm-3">
                  <h6 class="mb-0">First Name</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                  <input type="text" class="form-control" name="firstName" required>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                  <h6 class="mb-0">Last Name</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                  <input type="text" class="form-control" name="lastName" required>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                  <h6 class="mb-0">Address</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                  <input type="text" class="form-control" placeholder="Street Address" name="address" required>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                </div>
                <div class="col-sm-9 text-secondary">
                  <input type="text" class="form-control" name="areaLocalName" placeholder="Apartment,suit,unite ect(optional)">
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                  <h6 class="mb-0">City</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                  <input type="text" class="form-control" name="district" required>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                  <h6 class="mb-0">State</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                  <div class="autocomplete text-dark">
                    <input type="text" id="state" class="form-control" name="state" required>
                  </div>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                  <h6 class="mb-0">Pincode</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                  <input type="tel" minlength="6" maxlength="6" class="form-control" name="postcode" required>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                  <h6 class="mb-0">Phone</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                  <input type="tel" minlength="10" maxlength="10" class="form-control" name="mobileNumber" required>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-3"></div>
                <div class="col-sm-9 text-secondary">
                  <input type="submit" class="btn btn-outline-dark" value="Create new address">
                </div>
              </div>
            </div>
          </form>




          <!-- form for changing password -->





        
          <% if(user==true){%>
           
          <form action="/changePassword?_method=put" method="post" id="changePassword" class="p-3" style="display:none ;">
            <div class="mb-3">
              <label class="form-label">Current password</label>
              <input type="password" name="oldPassword" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">New password</label>
              <input type="password" name="password" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Repeat Password</label>
              <input type="password" name="confirmedPassword" class="form-control">
            </div>
            <button type="submit" class="btn btn-warning mt-2">change</button>
            <div class="mt-3" id="errorMessage"></div>
          </form>

          <% } else{%>
          <form action="/user/setPassword?_method=put" method="post" id="changePassword" class="p-3" style="display:none ;">
            <div class="mb-3">
              <label class="form-label">New password</label>
              <input type="password" name="password" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Repeat Password</label>
              <input type="password" name="confirmedPassword" class="form-control">
            </div>
            <button type="submit" class="btn btn-warning mt-2">change</button>
            <div class="mt-3" id="errorMessage"></div>
          </form>

          <% } %>
        </div>

        <div class="row mt-2 mb-2" id="myAddress">
          <div class="col-sm-12">
            <div class="card">
              <div class="card-body">
                <h5 class="d-flex align-items-center">My address</h5>
                <div class="row" id="addressList">
                  <% showAddress.forEach((data)=>{%>
                  <div class="col-md-6 mb-2" id="address-">
                    <div class="card">
                      <div class="card-body">
                        <h5 class="card-title"><i class="fa-solid fa-location-dot"></i><%= data.firstName %>  </h5>
                        <address class="card-text">
                          <%= data.firstName+' '+data.lastName %>, <%= data.state %> ,<%= data.address %>  <%=data.district%>  
                           <br>
                           Pincode: <%=data.postcode %><br>
                           Phone: <%=data.mobileNumber %> 

                         
                         
                        </address>
                        <button type="button" style="padding: 0;
                        border: none;
                        background: none; color:#ba9082;" class="mr-2" data-toggle="modal" data-target="#EDIT-ADDRESS<%=data.id%>" data-whatever="@mdo">Edit </button>
                        <!-- <button class="btn btn-outline-dark">Edit</button> -->
                        <button class="float-right btn btn-outline-secondary" onclick="removeAddress()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                          <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
                        </svg></button>
                      </div>
                    </div>
                  </div>




                  <div class="modal fade" id="EDIT-ADDRESS<%=data.id%>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Edit Address</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidd en="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <form action="/editAddress/<%=data.id%>" method="post" > 
                            <label for="recipient-name" class="col-form-label row">First Name </label> 
                            <div class="form-group row">
                              
                              <input type="text" class="form-control col-md-5 ml-3" id="recipient-name" name="firstName" value="<%= data.firstName %> " >
                             
                              <input type="text" class="form-control col-md-5 ml-2" id="recipient-name" name="lastName" value="<%= data.lastName%> " placeholder="Last Name" >

                            </div>
                           
                
                           
                            <label for="recipient-name" class="col-form-label ">Mobile Number</label>
                            <div class="form-group row ">
                              <input type="text" class="form-control col-md-6 ml-3" id="recipient-name" value="<%= data.mobileNumber %> " name="mobileNumber">
                             
                              
                               
                              <input type="text" class="form-control col-md-4 ml-3" id="recipient-name" placeholder="District" value="<%= data.district %> " name="district">
                            </div>
                  
                            <div class="form-group">
                              <label for="recipient-name" class="col-form-label">Address</label>
                              <input type="text" class="form-control" id="recipient-name" name="Address" value="<%= data.address %> ">
                            </div>
                            <label for="recipient-name" class="col-form-label ">Postcode</label>
                              <input type="text" multiple class="form-control col-md-6" id="recipient-name" name="postcode" value="<%=data.postcode%> ">
                            </div>
                            <div class="form-group">
                              <label for="recipient-name" class="col-form-label">Area Local Name</label>
                              <input type="text" class="form-control" id="recipient-name" name="areaLocalName" value="<%= data.areaLocalName %> ">
                            </div>
                            <div class="form-group">
                              <label for="recipient-name" class="col-form-label">Email</label>
                              <input type="text" class="form-control" id="recipient-name" name="email" value="<%= data.email %> ">
                            </div>
                            <label for="recipient-name" class="col-form-label ">Country</label>
                            <div class="form-group row ">
                              <input type="text" class="form-control col-md-6 ml-3" id="recipient-name" value="<%= data.country %> " name="country"> 
                              <input type="text" class="form-control col-md-4 ml-3" id="recipient-name" placeholder="District" value="<%= data.state %> " name="state">
                            </div>
                             <div class="modal-footer">
                           <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                           <button type="submit" class="btn btn-primary">Update</button>
                          </form>
                       
                        </div>
                      </div>
                    </div>
                  </div>
                  <% }) %> 
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById("userPassword").addEventListener("click", (event) => {
  event.preventDefault()
  document.getElementById("changePassword").style.display = ""
  document.getElementById("addressForm").style.display = "none"
  document.getElementById("myAddress").style.display = "none"

})

document.forms["changePassword"].addEventListener("submit", async (event) => {
  console.log("Enter change password")
    event.preventDefault()
    const data = new URLSearchParams(new FormData(event.target))
    try {
      console.log("Enter change password")
      const response = await axios(event.target.action, {
        method: "put",
        data: data
      })
      console.log("Enter change password")
      if (response.status == 201) {
        await Swal.fire({
          title: 'Congrats!',
          text: 'your password has been updated!',
          icon: 'success',
          width: '25em',
          timer: 2000
        })
      }
    } catch (err) {
      document.getElementById("errorMessage").innerHTML = `<div class="alert alert-danger text-center" role="alert">${err.response.data.message}</div>`
      setTimeout(() => {
        $("#errorMessage").fadeTo(600, 0).slideUp(500, function() {
          document.getElementById("errorMessage").innerHTML = ""
        })
      }, 1500)
    }
  })
 

</script>